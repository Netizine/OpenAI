<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Projects\Netizine.OpenAI\tests\Netizine.OpenAI.Tests\Infrastructure\FormEncoding\FormUrlEncodedContentTest.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
namespace OpenAI.Tests
{
    using System;
    using System.Collections.Generic;
    using System.IO;
    using System.Threading.Tasks;
    using OpenAI.Infrastructure.FormEncoding;
    using Xunit;

    public class FormUrlEncodedContentTest : BaseOpenAITest
    {
        [Fact]
        public void Ctor_NullSource_ThrowsArgumentNullException()
        {
            Assert.Throws&lt;ArgumentNullException&gt;(() =&gt; new FormUrlEncodedContent(null));
        }

        [Fact]
        public async Task Ctor_EmptySource_Succeed()
        {
            var content = new FormUrlEncodedContent(new Dictionary&lt;string, string&gt;());
            var stream = await content.ReadAsStreamAsync();
            Assert.Equal(0, stream.Length);
        }

        [Fact]
        public void Ctor_EmptySource_CorrectMediaTypeAndCharset()
        {
            var content = new FormUrlEncodedContent(new Dictionary&lt;string, string&gt;());
            Assert.Equal(&quot;application/x-www-form-urlencoded&quot;, content.Headers.ContentType.MediaType);
            Assert.Equal(&quot;utf-8&quot;, content.Headers.ContentType.CharSet);
            Assert.Equal(1, content.Headers.ContentType.Parameters.Count);
        }

        [Fact]
        public async Task Ctor_OneEntry_SeparatedByEquals()
        {
            var data = new Dictionary&lt;string, string&gt; { { &quot;key&quot;, &quot;value&quot; } };
            var content = new FormUrlEncodedContent(data);

            var stream = await content.ReadAsStreamAsync();
            Assert.Equal(9, stream.Length);
            var result = new StreamReader(stream).ReadToEnd();
            Assert.Equal(&quot;key=value&quot;, result);
        }

        [Fact]
        public async Task Ctor_OneUnicodeEntry_Encoded()
        {
            var data = new Dictionary&lt;string, string&gt; { { &quot;key&quot;, &quot;valueã‚¯&quot; } };
            var content = new FormUrlEncodedContent(data);

            var stream = await content.ReadAsStreamAsync();
            Assert.Equal(18, stream.Length);
            var result = new StreamReader(stream).ReadToEnd();
            Assert.Equal(&quot;key=value%E3%82%AF&quot;, result);
        }

        [Fact]
        public async Task Ctor_TwoEntries_SeparatedByAnd()
        {
            var data = new Dictionary&lt;string, string&gt;
            {
                { &quot;key1&quot;, &quot;value1&quot; },
                { &quot;key2&quot;, &quot;value2&quot; },
            };
            var content = new FormUrlEncodedContent(data);

            var stream = await content.ReadAsStreamAsync();
            Assert.Equal(23, stream.Length);
            var result = new StreamReader(stream).ReadToEnd();
            Assert.Equal(&quot;key1=value1&amp;key2=value2&quot;, result);
        }

        [Fact]
        public async Task Ctor_WithSpaces_EncodedAsPlus()
        {
            var data = new Dictionary&lt;string, string&gt;
            {
                { &quot;key 1&quot;, &quot;val%20ue 1&quot; },
                { &quot;key 2&quot;, &quot;val%ue 2&quot; },
            };
            var content = new FormUrlEncodedContent(data);

            var stream = await content.ReadAsStreamAsync();
            Assert.Equal(35, stream.Length);
            var result = new StreamReader(stream).ReadToEnd();
            Assert.Equal(&quot;key+1=val%2520ue+1&amp;key+2=val%25ue+2&quot;, result);
        }

        [Fact]
        public async Task Ctor_WithSquareBrackets_Unencoded()
        {
            var data = new Dictionary&lt;string, string&gt; { { &quot;key[subkey]&quot;, &quot;[#value]&quot; } };
            var content = new FormUrlEncodedContent(data);

            var stream = await content.ReadAsStreamAsync();
            Assert.Equal(22, stream.Length);
            var result = new StreamReader(stream).ReadToEnd();
            Assert.Equal(&quot;key[subkey]=[%23value]&quot;, result);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[15,13,15,56,1],[15,56,15,87,1],[15,87,15,89,1],[16,9,16,10,1],[21,13,21,87,1],[22,13,22,60,1],[23,13,23,44,1],[24,9,24,10,1],[29,13,29,87,1],[30,13,30,102,1],[31,13,31,72,1],[32,13,32,75,1],[33,9,33,10,1],[38,13,38,78,1],[39,13,39,59,1],[41,13,41,60,1],[42,13,42,44,1],[43,13,43,63,1],[44,13,44,47,1],[45,9,45,10,1],[50,13,50,79,1],[51,13,51,59,1],[53,13,53,60,1],[54,13,54,45,1],[55,13,55,63,1],[56,13,56,56,1],[57,9,57,10,1],[62,13,66,15,1],[67,13,67,59,1],[69,13,69,60,1],[70,13,70,45,1],[71,13,71,63,1],[72,13,72,61,1],[73,9,73,10,1],[78,13,82,15,1],[83,13,83,59,1],[85,13,85,60,1],[86,13,86,45,1],[87,13,87,63,1],[88,13,88,73,1],[89,9,89,10,1],[94,13,94,89,1],[95,13,95,59,1],[97,13,97,60,1],[98,13,98,45,1],[99,13,99,63,1],[100,13,100,60,1],[101,9,101,10,1]]);
    </script>
  </body>
</html>