<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Projects\Netizine.OpenAI\tests\Netizine.OpenAI.Tests\Infrastructure\FormEncoding\MultipartFormDataContentTest.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
namespace OpenAI.Tests
{
    using System;
    using System.Collections.Generic;
    using System.IO;
    using System.Text;
    using System.Threading.Tasks;
    using OpenAI.Infrastructure.FormEncoding;
    using Xunit;

    public class MultipartFormDataContentTest : BaseOpenAITest
    {
        [Fact]
        public void Ctor_NullSource_ThrowsArgumentNullException()
        {
            Assert.Throws&lt;ArgumentNullException&gt;(() =&gt; new MultipartFormDataContent(null));
        }

        [Fact]
        public void Ctor_EmptySource_CorrectMediaType()
        {
            var content = new MultipartFormDataContent(new Dictionary&lt;string, object&gt;());
            Assert.Equal(&quot;multipart/form-data&quot;, content.Headers.ContentType.MediaType);
            Assert.Equal(1, content.Headers.ContentType.Parameters.Count);
        }

        [Fact]
        public async Task Ctor_EmptySource_Success()
        {
            var source = new Dictionary&lt;string, object&gt;();
            var content = new MultipartFormDataContent(source, &quot;test-boundary&quot;);

            var stream = await content.ReadAsStreamAsync();
            Assert.Equal(38, stream.Length);
            var result = new StreamReader(stream).ReadToEnd();
            Assert.Equal(&quot;--test-boundary\r\n\r\n--test-boundary--\r\n&quot;, result);
        }

        [Fact]
        public async Task Ctor_OneStringEntry_Success()
        {
            var source = new Dictionary&lt;string, object&gt; { { &quot;key&quot;, &quot;valueク&quot; } };
            var content = new MultipartFormDataContent(source, &quot;test-boundary&quot;);

            var stream = await content.ReadAsStreamAsync();
            Assert.Equal(133, stream.Length);
            var result = new StreamReader(stream).ReadToEnd();
            Assert.Equal(
                &quot;--test-boundary\r\nContent-Type: text/plain; charset=utf-8\r\n&quot;
                + &quot;Content-Disposition: form-data; name=\&quot;key\&quot;\r\n\r\nvalueク\r\n--test-boundary--\r\n&quot;,
                result);
        }

        [Fact]
        public async Task Ctor_OneStreamEntry_Success()
        {
            var source = new Dictionary&lt;string, object&gt;
            {
                { &quot;key&quot;, new MemoryStream(Encoding.UTF8.GetBytes(&quot;Hello World!&quot;)) },
            };
            var content = new MultipartFormDataContent(source, &quot;test-boundary&quot;);

            var stream = await content.ReadAsStreamAsync();
            Assert.Equal(174, stream.Length);
            var result = new StreamReader(stream).ReadToEnd();
            Assert.Equal(
                &quot;--test-boundary\r\n&quot;
                + &quot;Content-Disposition: form-data; name=\&quot;key\&quot;; filename=blob; filename*=utf-8&#39;&#39;blob\r\n&quot;
                + &quot;Content-Type: application/octet-stream\r\n\r\nHello World!\r\n&quot;
                + &quot;--test-boundary--\r\n&quot;,
                result);
        }

        [Fact]
        public async Task Ctor_TwoEntries_Success()
        {
            var source = new Dictionary&lt;string, object&gt;
            {
                { &quot;stream&quot;, new MemoryStream(Encoding.UTF8.GetBytes(&quot;Hello クWorld!&quot;)) },
                { &quot;string&quot;, &quot;String!ク&quot; },
            };
            var content = new MultipartFormDataContent(source, &quot;test-boundary&quot;);

            var stream = await content.ReadAsStreamAsync();
            Assert.Equal(299, stream.Length);
            var result = new StreamReader(stream).ReadToEnd();
            Assert.Equal(
                &quot;--test-boundary\r\n&quot;
                + &quot;Content-Disposition: form-data; name=\&quot;stream\&quot;; filename=blob; filename*=utf-8&#39;&#39;blob\r\n&quot;
                + &quot;Content-Type: application/octet-stream\r\n\r\nHello クWorld!\r\n&quot;
                + &quot;--test-boundary\r\nContent-Type: text/plain; charset=utf-8\r\n&quot;
                + &quot;Content-Disposition: form-data; name=\&quot;string\&quot;\r\n\r\nString!ク\r\n--test-boundary--\r\n&quot;,
                result);
        }

        [Fact]
        public void Ctor_OneNonStringNonStreamEntry_ThrowsArgumentException()
        {
            var source = new Dictionary&lt;string, object&gt; { { &quot;key&quot;, 234 } };
            Assert.Throws&lt;ArgumentException&gt;(
                () =&gt; new MultipartFormDataContent(source, &quot;test-boundary&quot;));
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[16,13,16,56,1],[16,56,16,90,1],[16,90,16,92,1],[17,9,17,10,1],[22,13,22,90,1],[23,13,23,88,1],[24,13,24,75,1],[25,9,25,10,1],[30,13,30,59,1],[31,13,31,81,1],[33,13,33,60,1],[34,13,34,45,1],[35,13,35,63,1],[36,13,36,82,1],[37,9,37,10,1],[42,13,42,81,1],[43,13,43,81,1],[45,13,45,60,1],[46,13,46,46,1],[47,13,47,63,1],[48,13,51,25,1],[52,9,52,10,1],[57,13,60,15,1],[61,13,61,81,1],[63,13,63,60,1],[64,13,64,46,1],[65,13,65,63,1],[66,13,71,25,1],[72,9,72,10,1],[77,13,81,15,1],[82,13,82,81,1],[84,13,84,60,1],[85,13,85,46,1],[86,13,86,63,1],[87,13,93,25,1],[94,9,94,10,1],[99,13,99,76,1],[100,13,101,23,1],[101,23,101,76,1],[101,76,101,78,1],[102,9,102,10,1]]);
    </script>
  </body>
</html>