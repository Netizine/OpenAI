<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Projects\Netizine.OpenAI\tests\Netizine.OpenAI.Tests\Wholesome\DontSerializeNullDeletedAttrs.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
namespace OpenAI.Tests
{
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Reflection;
    using Newtonsoft.Json;
    using OpenAI;
    using Xunit;

    /// &lt;summary&gt;
    /// This test checks that &lt;see cref=&quot;OpenAIEntity&quot; /&gt; subclasses that have a
    /// &lt;c&gt;Deleted&lt;/c&gt; property have &lt;see cref=&quot;Newtonsoft.Json.NullValueHandling&quot; /&gt;
    /// set to &lt;see cref=&quot;Newtonsoft.Json.NullValueHandling.Ignore&quot; /&gt; so that the property is not
    /// serialized when its value is &lt;c&gt;null&lt;/c&gt;.
    /// &lt;/summary&gt;
    public class DontSerializeNullDeletedAttrs : WholesomeTest
    {
        private const string AssertionMessage =
            &quot;Found at least one invalid Deleted property. Make sure that the property &quot; +
            &quot;has a JsonPropertyAttribute and that NullValueHandling is set to Ignore.&quot;;

        [Fact]
        public void Check()
        {
            List&lt;string&gt; results = new List&lt;string&gt;();

            // Get all OpenAIEntity subclasses
            var entityClasses = GetSubclassesOf(typeof(OpenAIEntity));

            foreach (Type entityClass in entityClasses)
            {
                foreach (PropertyInfo property in entityClass.GetProperties())
                {
                    if (property.Name != &quot;Deleted&quot;)
                    {
                        continue;
                    }

                    // Check that property has a JsonPropertyAttribute
                    var attribute = property.GetCustomAttribute&lt;JsonPropertyAttribute&gt;();
                    if (attribute == null)
                    {
                        continue;
                    }

                    // Check that NullValueHanding is set to Ignore
                    if (attribute.NullValueHandling == NullValueHandling.Ignore)
                    {
                        continue;
                    }

                    results.Add($&quot;{entityClass.Name}.{property.Name}&quot;);
                }
            }

            if (results.Any())
            {
                // Sort results alphabetically
                results = results.OrderBy(i =&gt; i).ToList();

                // Display our own error message (because Assert.Empty truncates the results)
                Console.WriteLine(&quot;Found invalid Deleted properties:&quot;);
                foreach (string item in results)
                {
                    Console.WriteLine($&quot;- {item}&quot;);
                }

                // Actually fail test
                Assert.True(false, AssertionMessage);
            }
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[26,13,26,55,1],[29,13,29,71,1],[31,22,31,38,1],[31,39,31,41,1],[31,42,31,55,1],[33,26,33,47,1],[33,48,33,50,1],[33,51,33,78,1],[35,21,35,52,1],[41,21,41,90,1],[42,21,42,43,1],[48,21,48,81,1],[53,21,53,72,0],[57,13,57,31,1],[60,17,60,48,0],[60,48,60,49,0],[60,49,60,60,0],[63,17,63,72,0],[64,26,64,37,0],[64,38,64,40,0],[64,41,64,48,0],[66,21,66,52,0],[70,17,70,54,0],[72,9,72,10,1]]);
    </script>
  </body>
</html>