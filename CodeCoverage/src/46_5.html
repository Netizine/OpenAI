<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Projects\Netizine.OpenAI\tests\Netizine.OpenAI.Tests\Infrastructure\Public\OpenAIRequestTest.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
namespace OpenAI.Tests
{
    using System.Net.Http;
    using System.Threading.Tasks;
    using OpenAI;
    using OpenAI.Tests.Infrastructure.TestData;
    using Xunit;

    public class OpenAIRequestTest : BaseOpenAITest
    {
        private readonly IOpenAIClient openAIClient;

        public OpenAIRequestTest()
        {
            this.openAIClient = new OpenAIClient(
                &quot;sk-test&quot;, null,
                apiBase: &quot;https://client.example.com&quot;);
        }

        [Fact]
        public void Ctor_GetRequest()
        {
            var request = new OpenAIRequest(
                this.openAIClient,
                HttpMethod.Get,
                &quot;/get&quot;,
                new TestOptions { String = &quot;string!&quot; },
                new RequestOptions());

            Assert.Equal(HttpMethod.Get, request.Method);
            Assert.Equal($&quot;{this.openAIClient.ApiBase}/get?string=string!&quot;, request.Uri.ToString());
            Assert.Equal(
                $&quot;Bearer {this.openAIClient.ApiKey}&quot;,
                request.AuthorizationHeader.ToString());
            Assert.False(request.OpenAIHeaders.ContainsKey(&quot;OpenAI-Organization&quot;));
            Assert.Null(request.Content);
        }

        [Fact]
        public async Task Ctor_PostRequest()
        {
            var request = new OpenAIRequest(
                this.openAIClient,
                HttpMethod.Post,
                &quot;/v1/edits&quot;,
                new TestOptions { String = &quot;{\r\n  \&quot;model\&quot;: \&quot;text-davinci-edit-001\&quot;,\r\n  \&quot;input\&quot;: \&quot;What day of the wek is it?\&quot;,\r\n  \&quot;instruction\&quot;: \&quot;Fix the spelling mistakes.\&quot;,\r\n  \&quot;n\&quot;: 1,\r\n  \&quot;temperature\&quot;: 1,\r\n  \&quot;top_p\&quot;: 1\r\n}&quot; },
                new RequestOptions());

            Assert.Equal(HttpMethod.Post, request.Method);
            Assert.Equal($&quot;{this.openAIClient.ApiBase}/v1/edits&quot;, request.Uri.ToString());
            Assert.Equal(
                $&quot;Bearer {this.openAIClient.ApiKey}&quot;,
                request.AuthorizationHeader.ToString());
            Assert.NotNull(request.Content);
            var content = await request.Content.ReadAsStringAsync();
            Assert.Equal(&quot;string=%7B%0D%0A++%22model%22%3A+%22text-davinci-edit-001%22%2C%0D%0A++%22input%22%3A+%22What+day+of+the+wek+is+it%3F%22%2C%0D%0A++%22instruction%22%3A+%22Fix+the+spelling+mistakes.%22%2C%0D%0A++%22n%22%3A+1%2C%0D%0A++%22temperature%22%3A+1%2C%0D%0A++%22top_p%22%3A+1%0D%0A%7D&quot;, content);
        }

        [Fact]
        public void Ctor_DeleteRequest()
        {
            var request = new OpenAIRequest(
                this.openAIClient,
                HttpMethod.Delete,
                &quot;/delete&quot;,
                new TestOptions { String = &quot;string!&quot; },
                new RequestOptions());

            Assert.Equal(HttpMethod.Delete, request.Method);
            Assert.Equal(
                $&quot;{this.openAIClient.ApiBase}/delete?string=string!&quot;,
                request.Uri.ToString());
            Assert.Equal(
                $&quot;Bearer {this.openAIClient.ApiKey}&quot;,
                request.AuthorizationHeader.ToString());
            Assert.False(request.OpenAIHeaders.ContainsKey(&quot;OpenAI-Organization&quot;));
            Assert.Null(request.Content);
        }

        [Fact]
        public void Ctor_RequestOptions()
        {
            var client = new OpenAIClient(&quot;sk-test&quot;);
            var requestOptions = new RequestOptions
            {
                ApiKey = &quot;sk_override&quot;,
                OrganizationId = &quot;organization_id&quot;,
                BaseUrl = &quot;https://override.example.com&quot;
            };
            var request = new OpenAIRequest(
                this.openAIClient,
                HttpMethod.Get,
                &quot;/v1/engines&quot;,
                null,
                requestOptions);

            Assert.Equal(HttpMethod.Get, request.Method);
            Assert.Equal($&quot;{requestOptions.BaseUrl}/v1/engines&quot;, request.Uri.ToString());
            Assert.Equal($&quot;Bearer {requestOptions.ApiKey}&quot;, request.AuthorizationHeader.ToString());
            Assert.True(request.OpenAIHeaders.ContainsKey(&quot;OpenAI-Organization&quot;));
            Assert.Equal(&quot;organization_id&quot;, request.OpenAIHeaders[&quot;OpenAI-Organization&quot;]);
            Assert.Null(request.Content);
        }

        [Fact]
        public void Ctor_ThrowsIfApiKeyIsNull()
        {
            var client = new OpenAIClient(null);
            var requestOptions = new RequestOptions();

            var exception = Assert.Throws&lt;OpenAIException&gt;(() =&gt;
                new OpenAIRequest(client, HttpMethod.Get, &quot;/get&quot;, null, requestOptions));

            Assert.Contains(&quot;No API key provided.&quot;, exception.Message);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[13,9,13,35,1],[15,13,17,56,1],[18,9,18,10,1],[23,13,28,39,1],[30,13,30,58,1],[31,13,31,101,1],[32,13,34,57,1],[35,13,35,84,1],[36,13,36,42,1],[37,9,37,10,1],[42,13,47,39,1],[49,13,49,59,1],[50,13,50,91,1],[51,13,53,57,1],[54,13,54,45,1],[55,13,55,69,1],[56,13,56,315,1],[57,9,57,10,1],[62,13,67,39,1],[69,13,69,61,1],[70,13,72,41,1],[73,13,75,57,1],[76,13,76,84,1],[77,13,77,42,1],[78,9,78,10,1],[83,13,83,54,1],[84,13,89,15,1],[90,13,95,33,1],[97,13,97,58,1],[98,13,98,90,1],[99,13,99,101,1],[100,13,100,83,1],[101,13,101,91,1],[102,13,102,42,1],[103,9,103,10,1],[108,13,108,49,1],[109,13,109,55,1],[111,13,112,17,1],[112,17,112,88,1],[112,88,112,90,1],[114,13,114,72,1],[115,9,115,10,1]]);
    </script>
  </body>
</html>