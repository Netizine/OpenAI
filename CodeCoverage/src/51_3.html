<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Projects\Netizine.OpenAI\tests\Netizine.OpenAI.Tests\Infrastructure\JsonUtilsTest.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
namespace OpenAI.Tests
{
    using Newtonsoft.Json;
    using OpenAI.Infrastructure;
    using Xunit;

    public class JsonUtilsTest : BaseOpenAITest
    {
        [Fact]
        public void DeserializeObjectIgnoresDefaultSettings()
        {
            var origDefaultSettings = JsonConvert.DefaultSettings;

            try
            {
                JsonConvert.DefaultSettings = () =&gt; new JsonSerializerSettings
                {
                    MissingMemberHandling = MissingMemberHandling.Error,
                };

                var s = &quot;{\&quot;int\&quot;:234,\&quot;string\&quot;:\&quot;Hello!\&quot;,\&quot;foo\&quot;:\&quot;bar\&quot;}&quot;;

                // Deserialization throws an exception because of the extra `foo` property that is
                // missing in the TestObject class.
                Assert.Throws&lt;JsonSerializationException&gt;(() =&gt;
                    JsonConvert.DeserializeObject&lt;TestObject&gt;(s));

                // Deserialization succeeds because we&#39;re not using DefaultSettings, so
                // MissingMemberHandling is set to its default value Ignore instead of Error.
                var objOpenAI = JsonUtils.DeserializeObject&lt;TestObject&gt;(s);
                Assert.NotNull(objOpenAI);
                Assert.Equal(234, objOpenAI.Int);
                Assert.Equal(&quot;Hello!&quot;, objOpenAI.String);
            }
            finally
            {
                JsonConvert.DefaultSettings = origDefaultSettings;
            }
        }

        [Fact]
        public void SerializeObjectIgnoresDefaultSettings()
        {
            var origDefaultSettings = JsonConvert.DefaultSettings;

            try
            {
                JsonConvert.DefaultSettings = () =&gt; new JsonSerializerSettings
                {
                    Formatting = Formatting.Indented,
                    PreserveReferencesHandling = PreserveReferencesHandling.All,
                };

                var o = new TestObject { Int = 234, String = &quot;Hello!&quot; };

                // Serialized string is formatted with newlines and indentation because of
                // Formatting.Indented, and includes `$id` keys because of
                // PreserveReferencesHandling.All.
                var jsonDefault = JsonConvert.SerializeObject(o);
                jsonDefault = jsonDefault.Replace(&quot;\r\n&quot;, &quot;\n&quot;);
                Assert.Equal(
                    &quot;{\n  \&quot;$id\&quot;: \&quot;1\&quot;,\n  \&quot;int\&quot;: 234,\n  \&quot;string\&quot;: \&quot;Hello!\&quot;\n}&quot;,
                    jsonDefault);

                // Serialized string is not formatted and doesn&#39;t include `$id` keys because
                // we&#39;re not using DefaultSettings.
                var jsonOpenAI = JsonUtils.SerializeObject(o);
                jsonOpenAI = jsonOpenAI.Replace(&quot;\r\n&quot;, &quot;\n&quot;);
                Assert.Equal(&quot;{\&quot;int\&quot;:234,\&quot;string\&quot;:\&quot;Hello!\&quot;}&quot;, jsonOpenAI);
            }
            finally
            {
                JsonConvert.DefaultSettings = origDefaultSettings;
            }
        }

        [JsonObject]
        private class TestObject
        {
            [JsonProperty(&quot;int&quot;)]
            public int Int { get; set; }

            [JsonProperty(&quot;string&quot;)]
            public string String { get; set; }
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[12,13,12,67,1],[16,17,16,53,1],[16,53,19,18,1],[19,18,19,19,1],[21,17,21,79,1],[25,17,26,21,1],[26,21,26,65,1],[26,65,26,67,1],[30,17,30,76,1],[31,17,31,43,1],[32,17,32,50,1],[33,17,33,58,1],[34,13,34,14,1],[37,17,37,67,1],[38,13,38,14,1],[39,9,39,10,1],[44,13,44,67,1],[48,17,48,53,1],[48,53,52,18,1],[52,18,52,19,1],[54,17,54,73,1],[59,17,59,66,1],[60,17,60,65,1],[61,17,63,34,1],[67,17,67,63,1],[68,17,68,63,1],[69,17,69,81,1],[70,13,70,14,1],[73,17,73,67,1],[74,13,74,14,1],[75,9,75,10,1],[81,30,81,34,1],[81,35,81,39,1],[84,36,84,40,1],[84,41,84,45,1]]);
    </script>
  </body>
</html>