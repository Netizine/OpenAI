<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Projects\Netizine.OpenAI\tests\Netizine.OpenAI.Tests\Infrastructure\JsonConverters\AnyOfConverterTest.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
namespace OpenAI.Tests
{
    using Newtonsoft.Json;
    using OpenAI;
    using OpenAI.Infrastructure;
    using Xunit;

    public class AnyOfConverterTest : BaseOpenAITest
    {
        [Fact]
        public void DeserializeFirstType()
        {
            var json = &quot;{\n  \&quot;any_of\&quot;: \&quot;String!\&quot;\n}&quot;;
            var obj = JsonConvert.DeserializeObject&lt;TestObject&gt;(json);

            Assert.NotNull(obj.AnyOf);
            Assert.Equal(&quot;String!&quot;, obj.AnyOf);
        }

        [Fact]
        public void DeserializeSecondType()
        {
            var json = &quot;{\n  \&quot;any_of\&quot;: {\n    \&quot;id\&quot;: \&quot;id_123\&quot;,\n    \&quot;bar\&quot;: 42\n  }\n}&quot;;
            var obj = JsonConvert.DeserializeObject&lt;TestObject&gt;(json);

            Assert.NotNull(obj.AnyOf);
            Assert.Equal(&quot;id_123&quot;, ((TestSubObject)obj.AnyOf).Id);
            Assert.Equal(42, ((TestSubObject)obj.AnyOf).Bar);
        }

        [Fact]
        public void DeserializeNull()
        {
            var json = &quot;{\n  \&quot;any_of\&quot;: null\n}&quot;;
            var obj = JsonConvert.DeserializeObject&lt;TestObject&gt;(json);

            Assert.Null(obj.AnyOf);
        }

        [Fact]
        public void DeserializeUnexpectedType()
        {
            var json = &quot;{\n  \&quot;any_of\&quot;: []\n}&quot;;

            var exception = Assert.Throws&lt;JsonSerializationException&gt;(() =&gt;
                JsonConvert.DeserializeObject&lt;TestObject&gt;(json));

            Assert.Contains(
                &quot;Cannot deserialize the current JSON object into any of the expected types&quot;,
                exception.Message);
        }

        [Fact]
        public void SerializeFirstType()
        {
            var obj = new TestObject
            {
                AnyOf = &quot;String!&quot;,
            };

            var expected = &quot;{\n  \&quot;any_of\&quot;: \&quot;String!\&quot;\n}&quot;;
            Assert.Equal(expected, obj.ToJson().Replace(&quot;\r\n&quot;, &quot;\n&quot;));
        }

        [Fact]
        public void SerializeSecondType()
        {
            var obj = new TestObject
            {
                AnyOf = new TestSubObject
                {
                    Id = &quot;id_123&quot;,
                    Bar = 42,
                },
            };

            var expected =
                &quot;{\n  \&quot;any_of\&quot;: {\n    \&quot;id\&quot;: \&quot;id_123\&quot;,\n    \&quot;bar\&quot;: 42\n  }\n}&quot;;
            Assert.Equal(expected, obj.ToJson().Replace(&quot;\r\n&quot;, &quot;\n&quot;));
        }

        [Fact]
        public void SerializeNull()
        {
            var obj = new TestObject
            {
                AnyOf = null,
            };

            var expected = &quot;{\n  \&quot;any_of\&quot;: null\n}&quot;;
            Assert.Equal(expected, obj.ToJson().Replace(&quot;\r\n&quot;, &quot;\n&quot;));
        }

        private class TestSubObject : OpenAIEntity&lt;TestSubObject&gt;, IHasId
        {
            [JsonProperty(&quot;id&quot;)]
            public string Id { get; set; }

            [JsonProperty(&quot;bar&quot;)]
            public int Bar { get; set; }
        }

        private class TestObject : OpenAIEntity&lt;TestObject&gt;
        {
            [JsonProperty(&quot;any_of&quot;)]
            [JsonConverter(typeof(AnyOfConverter))]
            internal AnyOf&lt;string, TestSubObject&gt; AnyOf { get; set; }
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[13,13,13,58,1],[14,13,14,71,1],[16,13,16,39,1],[17,13,17,48,1],[18,9,18,10,1],[23,13,23,95,1],[24,13,24,71,1],[26,13,26,39,1],[27,13,27,67,1],[28,13,28,62,1],[29,9,29,10,1],[34,13,34,51,1],[35,13,35,71,1],[37,13,37,36,1],[38,9,38,10,1],[43,13,43,49,1],[45,13,46,17,1],[46,17,46,64,1],[46,64,46,66,1],[48,13,50,36,1],[51,9,51,10,1],[56,13,59,15,1],[61,13,61,62,1],[62,13,62,72,1],[63,9,63,10,1],[68,13,75,15,1],[77,13,78,88,1],[79,13,79,72,1],[80,9,80,10,1],[85,13,88,15,1],[90,13,90,55,1],[91,13,91,72,1],[92,9,92,10,1],[97,32,97,36,1],[97,37,97,41,1],[100,30,100,34,1],[100,35,100,39,1],[107,59,107,63,1],[107,64,107,68,1]]);
    </script>
  </body>
</html>